<div class="reactive-parameters-container">
  <div class="section">
    <h2>Reactive Parameters with Observables</h2>
    <p class="intro">
      Learn how to handle route parameters reactively using RxJS observables, including parameter changes, reactive forms integration, and advanced parameter handling patterns.
    </p>
  </div>

  <div class="reactive-basics-section">
    <h3>Reactive Parameter Basics</h3>
    <div class="basics-grid">
      <div class="basic-card">
        <h4>Observable Parameter Subscription</h4>
        <div class="code-example">
          <pre><code>import &#123; Component, OnInit, OnDestroy &#125; from '&#64;angular/core';
import &#123; ActivatedRoute &#125; from '&#64;angular/router';
import &#123; Subject, takeUntil &#125; from 'rxjs';

export class UserComponent implements OnInit, OnDestroy &#123;
  private destroy$ = new Subject&lt;void&gt;();

  constructor(private route: ActivatedRoute) &#123;&#125;

  ngOnInit() &#123;
    this.route.paramMap
      .pipe(takeUntil(this.destroy$))
      .subscribe(params => &#123;
        const userId = params.get('id');
        this.loadUser(userId);
      &#125;);
  &#125;

  ngOnDestroy() &#123;
    this.destroy$.next();
    this.destroy$.complete();
  &#125;
&#125;</code></pre>
        </div>
        <p>Subscribe to parameter changes reactively with proper cleanup.</p>
      </div>

      <div class="basic-card">
        <h4>Parameter Transformation</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => Number(params.get('id'))),
      filter(id => !isNaN(id)),
      takeUntil(this.destroy$)
    )
    .subscribe(userId => &#123;
      this.loadUser(userId);
    &#125;);
&#125;</code></pre>
        </div>
        <p>Transform and validate parameters using RxJS operators.</p>
      </div>

      <div class="basic-card">
        <h4>Multiple Parameter Handling</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => &#123;
        category: params.get('category'),
        id: Number(params.get('id'))
      &#125;),
      filter(params => params.category && !isNaN(params.id)),
      takeUntil(this.destroy$)
    )
    .subscribe(params => &#123;
      this.loadProduct(params.category, params.id);
    &#125;);
&#125;</code></pre>
        </div>
        <p>Handle multiple parameters with object destructuring.</p>
      </div>
    </div>
  </div>

  <div class="reactive-forms-section">
    <h3>Reactive Forms with Route Parameters</h3>
    <div class="forms-grid">
      <div class="form-card">
        <h4>Form Initialization from Parameters</h4>
        <div class="code-example">
          <pre><code>import &#123; FormBuilder, FormGroup &#125; from '&#64;angular/forms';

export class EditUserComponent &#123;
  userForm: FormGroup;

  constructor(
    private fb: FormBuilder,
    private route: ActivatedRoute
  ) &#123;
    this.userForm = this.fb.group(&#123;
      id: [''],
      name: [''],
      email: ['']
    &#125;);
  &#125;

  ngOnInit() &#123;
    this.route.paramMap
      .pipe(
        map(params => Number(params.get('id'))),
        filter(id => !isNaN(id)),
        takeUntil(this.destroy$)
      )
      .subscribe(userId => &#123;
        this.loadUserAndUpdateForm(userId);
      &#125;);
  &#125;

  private loadUserAndUpdateForm(userId: number) &#123;
    this.userService.getUser(userId).subscribe(user => &#123;
      this.userForm.patchValue(user);
    &#125;);
  &#125;
&#125;</code></pre>
        </div>
        <p>Initialize reactive forms with route parameter data.</p>
      </div>

      <div class="form-card">
        <h4>Dynamic Form Controls</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => &#123;
        userId: Number(params.get('id')),
        mode: params.get('mode') || 'edit'
      &#125;),
      takeUntil(this.destroy$)
    )
    .subscribe(params => &#123;
      this.initializeForm(params.userId, params.mode);
    &#125;);
&#125;

private initializeForm(userId: number, mode: string) &#123;
  if (mode === 'view') &#123;
    this.userForm.disable();
  &#125;

  // Add dynamic controls based on user type
  this.route.paramMap
    .pipe(take(1))
    .subscribe(params => &#123;
      const type = params.get('type');
      this.addTypeSpecificControls(type);
    &#125;);
&#125;

private addTypeSpecificControls(type: string | null) &#123;
  switch(type) &#123;
    case 'admin':
      this.userForm.addControl('role', this.fb.control(''));
      break;
    case 'customer':
      this.userForm.addControl('preferences', this.fb.control(''));
      break;
  &#125;
&#125;</code></pre>
        </div>
        <p>Dynamically add form controls based on route parameters.</p>
      </div>

      <div class="form-card">
        <h4>Form Validation with Parameters</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => Number(params.get('id'))),
      filter(id => !isNaN(id)),
      switchMap(userId => this.userService.getUser(userId)),
      catchError(error => &#123;
        this.router.navigate(['/error']);
        return EMPTY;
      &#125;),
      takeUntil(this.destroy$)
    )
    .subscribe(user => &#123;
      this.userForm.patchValue(user);
      this.validateUserPermissions(user);
    &#125;);
&#125;</code></pre>
        </div>
        <p>Validate form data based on route parameters and user permissions.</p>
      </div>
    </div>
  </div>

  <div class="advanced-patterns-section">
    <h3>Advanced Reactive Patterns</h3>
    <div class="patterns-grid">
      <div class="pattern-card">
        <h4>Parameter Caching</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => &#123;
        category: params.get('category'),
        id: Number(params.get('id'))
      &#125;),
      distinctUntilChanged((prev, curr) =>
        prev.category === curr.category && prev.id === curr.id
      ),
      takeUntil(this.destroy$)
    )
    .subscribe(params => &#123;
      this.loadProduct(params.category, params.id);
    &#125;);
&#125;</code></pre>
        </div>
        <p>Use distinctUntilChanged to prevent unnecessary API calls.</p>
      </div>

      <div class="pattern-card">
        <h4>Parameter Debouncing</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => &#123;
        view: params.get('view') || 'overview',
        period: params.get('period') || 'week'
      &#125;),
      debounceTime(300),
      takeUntil(this.destroy$)
    )
    .subscribe(params => &#123;
      this.loadDashboard(params.view, params.period);
    &#125;);
&#125;</code></pre>
        </div>
        <p>Debounce parameter changes to prevent excessive API calls.</p>
      </div>

      <div class="pattern-card">
        <h4>Combined Parameter Streams</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  combineLatest([
    this.route.paramMap,
    this.route.queryParamMap
  ]).pipe(
    map(([params, queryParams]) => &#123;
      contentType: params.get('type'),
      category: queryParams.get('category'),
      page: Number(queryParams.get('page')) || 1
    &#125;),
    takeUntil(this.destroy$)
  ).subscribe(filters => &#123;
    this.loadContent(filters);
  &#125;);
&#125;</code></pre>
        </div>
        <p>Combine route parameters with query parameters.</p>
      </div>
    </div>
  </div>

  <div class="real-world-examples-section">
    <h3>Real-World Examples</h3>
    <div class="examples-grid">
      <div class="example-card">
        <h4>ðŸ›’ E-commerce Product Details</h4>
        <div class="code-example">
          <pre><code>export class ProductDetailComponent &#123;
  ngOnInit() &#123;
    this.route.paramMap
      .pipe(
        map(params => &#123;
          category: params.get('category'),
          id: Number(params.get('id'))
        &#125;),
        filter(params => params.category && !isNaN(params.id)),
        switchMap(params => this.productService.getProduct(params.category, params.id)),
        catchError(error => &#123;
          this.router.navigate(['/products']);
          return EMPTY;
        &#125;),
        takeUntil(this.destroy$)
      )
      .subscribe(product => &#123;
        this.product = product;
        this.loadRelatedProducts(product.category);
      &#125;);
  &#125;
&#125;</code></pre>
        </div>
        <p>Load product details with error handling and related products.</p>
      </div>

      <div class="example-card">
        <h4>ðŸ“Š Analytics Dashboard</h4>
        <div class="code-example">
          <pre><code>export class AnalyticsComponent &#123;
  ngOnInit() &#123;
    this.route.paramMap
      .pipe(
        map(params => &#123;
          mode: params.get('mode'),
          period: params.get('period') || 'month'
        &#125;),
        distinctUntilChanged(),
        switchMap(config => this.analyticsService.getData(config)),
        takeUntil(this.destroy$)
      )
      .subscribe(data => &#123;
        this.updateDashboard(data);
      &#125;);
  &#125;
&#125;</code></pre>
        </div>
        <p>Reactive analytics dashboard with parameter-based configuration.</p>
      </div>

      <div class="example-card">
        <h4>ðŸ‘¥ User Management</h4>
        <div class="code-example">
          <pre><code>export class UserEditComponent &#123;
  ngOnInit() &#123;
    this.route.paramMap
      .pipe(
        map(params => &#123;
          userId: Number(params.get('id')),
          mode: params.get('mode') || 'edit'
        &#125;),
        filter(params => !isNaN(params.userId)),
        switchMap(params => this.userService.getUser(params.userId)),
        takeUntil(this.destroy$)
      )
      .subscribe(user => &#123;
        this.initializeForm(user);
        this.setFormMode(this.route.snapshot.paramMap.get('mode'));
      &#125;);
  &#125;
&#125;</code></pre>
        </div>
        <p>User management with reactive form initialization and mode handling.</p>
      </div>
    </div>
  </div>

  <div class="best-practices-section">
    <h3>Best Practices</h3>
    <div class="practices-list">
      <div class="practice-item">
        <h4>âœ… Always Use takeUntil</h4>
        <p>Prevent memory leaks by using takeUntil with a destroy subject.</p>
      </div>

      <div class="practice-item">
        <h4>âœ… Handle Errors Gracefully</h4>
        <p>Use catchError to handle parameter-related errors and redirect appropriately.</p>
      </div>

      <div class="practice-item">
        <h4>âœ… Validate Parameters</h4>
        <p>Use filter operators to validate parameters before processing.</p>
      </div>

      <div class="practice-item">
        <h4>âœ… Use Appropriate Operators</h4>
        <p>Choose the right RxJS operators for your use case (map, filter, switchMap, etc.).</p>
      </div>

      <div class="practice-item">
        <h4>âœ… Avoid Nested Subscriptions</h4>
        <p>Use switchMap, mergeMap, or combineLatest instead of nested subscriptions.</p>
      </div>
    </div>
  </div>

  <div class="common-patterns-section">
    <h3>Common Reactive Parameter Patterns</h3>
    <div class="patterns-grid">
      <div class="pattern-card">
        <h4>Simple Parameter Loading</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => Number(params.get('id'))),
      filter(id => !isNaN(id)),
      takeUntil(this.destroy$)
    )
    .subscribe(id => this.loadData(id));
&#125;</code></pre>
        </div>
        <p>Basic pattern for loading data based on route parameters.</p>
      </div>

      <div class="pattern-card">
        <h4>Parameter with Query Params</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  combineLatest([
    this.route.paramMap,
    this.route.queryParamMap
  ]).pipe(
    map(([params, queryParams]) => &#123;
      id: Number(params.get('id')),
      view: queryParams.get('view') || 'details'
    &#125;),
    takeUntil(this.destroy$)
  ).subscribe(config => this.loadView(config));
&#125;</code></pre>
        </div>
        <p>Combine route parameters with query parameters.</p>
      </div>

      <div class="pattern-card">
        <h4>Parameter with Error Handling</h4>
        <div class="code-example">
          <pre><code>ngOnInit() &#123;
  this.route.paramMap
    .pipe(
      map(params => Number(params.get('id'))),
      filter(id => !isNaN(id)),
      switchMap(id => this.service.getData(id)),
      catchError(error => &#123;
        this.router.navigate(['/error']);
        return EMPTY;
      &#125;),
      takeUntil(this.destroy$)
    )
    .subscribe(data => this.processData(data));
&#125;</code></pre>
        </div>
        <p>Handle errors gracefully with proper error handling.</p>
      </div>
    </div>
  </div>
</div>
