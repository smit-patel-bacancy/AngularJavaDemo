<div class="observables-signals-demo">
  <div class="header">
    <h1>Observables & Signals Demo</h1>
    <p>Comprehensive demonstration of Angular Observables and Signals</p>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button
      *ngFor="let tab of tabs"
      [class.active]="activeTab() === tab"
      (click)="setActiveTab(tab)"
      class="tab-button">
      {{ tab | titlecase }}
    </button>
  </div>

  <!-- Error Display -->
  <div *ngIf="error()" class="error-banner">
    <span>{{ error() }}</span>
    <button (click)="error.set(null)" class="close-btn">×</button>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading()" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Content Sections -->
  <div class="content-area">

    <!-- OBSERVABLES SECTION -->
    <div *ngIf="activeTab() === 'observables'" class="tab-content">
      <div class="section">
        <h2>1. What are Observables?</h2>
        <div class="explanation">
          <p>Observables are lazy collections of multiple values over time. They provide a way to handle asynchronous data streams.</p>
                     <div class="code-example">
             <h4>Basic Observable Example:</h4>
             <pre><code>const observable$ = of('Hello', 'World', 'from', 'Observable');
observable$.subscribe(data =&gt; console.log(data));</code></pre>
           </div>
        </div>

        <div class="demo-section">
          <h3>Observable Data Stream:</h3>
          <div class="data-display">
            <div *ngFor="let item of observableData" class="data-item">
              {{ item }}
            </div>
          </div>
          <button (click)="clearData()" class="btn btn-secondary">Clear Data</button>
        </div>
      </div>

      <div class="section">
        <h2>2. Angular Observables</h2>
        <div class="explanation">
          <p>Angular uses Observables extensively for HTTP requests, routing, forms, and more.</p>
        </div>

        <div class="demo-section">
          <h3>Common Angular Observable Patterns:</h3>
          <ul>
            <li><strong>HTTP Requests:</strong> HttpClient returns Observables</li>
            <li><strong>Router Events:</strong> Navigation and route changes</li>
            <li><strong>Form Controls:</strong> Value changes and validation</li>
            <li><strong>Async Pipe:</strong> Automatic subscription management</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- SIGNALS SECTION -->
    <div *ngIf="activeTab() === 'signals'" class="tab-content">
      <div class="section">
        <h2>Angular Signals</h2>
        <div class="explanation">
          <p>Signals are a new reactivity primitive in Angular that provide fine-grained reactivity and better performance.</p>
        </div>

        <div class="demo-section">
          <h3>Basic Signal Demo:</h3>
          <div class="signal-demo">
            <div class="counter-display">
              <h4>Count: {{ count() }}</h4>
              <h4>Double Count: {{ doubleCount() }}</h4>
            </div>
            <div class="counter-controls">
              <button (click)="incrementCount()" class="btn btn-primary">+</button>
              <button (click)="decrementCount()" class="btn btn-primary">-</button>
              <button (click)="resetCount()" class="btn btn-secondary">Reset</button>
            </div>
          </div>
        </div>

        <div class="demo-section">
          <h3>User Management with Signals:</h3>
          <div class="user-management">
                         <div class="user-input">
               <input
                 type="text"
                 placeholder="Filter users..."
                 [value]="userInput()"
                 (input)="updateUserInput($any($event.target).value)"
                 class="form-input">
             </div>

            <div class="user-form">
              <input type="text" #nameInput placeholder="Name" class="form-input">
              <input type="email" #emailInput placeholder="Email" class="form-input">
              <button
                (click)="addUser(nameInput.value, emailInput.value); nameInput.value=''; emailInput.value=''"
                class="btn btn-primary">
                Add User
              </button>
            </div>

            <div class="users-list">
              <h4>Users ({{ filteredUsers().length }}):</h4>
              <div *ngFor="let user of filteredUsers()" class="user-item">
                <span>{{ user.name }} ({{ user.email }})</span>
                <button (click)="removeUser(user.id)" class="btn btn-danger">Remove</button>
              </div>
            </div>
          </div>
        </div>

        <div class="demo-section">
          <h3>Signal Effects:</h3>
          <p>Effects automatically run when signal dependencies change. Check the console for logs.</p>
          <button (click)="simulateLoading()" class="btn btn-primary">Simulate Loading</button>
          <button (click)="simulateError()" class="btn btn-warning">Simulate Error</button>
        </div>
      </div>
    </div>

    <!-- COMPARISON SECTION -->
    <div *ngIf="activeTab() === 'comparison'" class="tab-content">
      <div class="section">
        <h2>Observables vs Promises</h2>
        <div class="comparison-table">
          <table>
            <thead>
              <tr>
                <th>Feature</th>
                <th>Observables</th>
                <th>Promises</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Multiple Values</td>
                <td>✅ Yes</td>
                <td>❌ No</td>
              </tr>
              <tr>
                <td>Cancellation</td>
                <td>✅ Yes</td>
                <td>❌ No</td>
              </tr>
              <tr>
                <td>Lazy Execution</td>
                <td>✅ Yes</td>
                <td>❌ No</td>
              </tr>
              <tr>
                <td>Operators</td>
                <td>✅ Rich set</td>
                <td>❌ Limited</td>
              </tr>
              <tr>
                <td>Error Handling</td>
                <td>✅ Built-in</td>
                <td>✅ Built-in</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="demo-section">
          <h3>Side-by-Side Demo:</h3>
          <button (click)="demonstratePromiseVsObservable()" class="btn btn-primary">
            Run Promise vs Observable Demo
          </button>

          <div class="comparison-results">
            <div class="promise-results">
              <h4>Promise Results:</h4>
              <div *ngFor="let item of promiseData" class="result-item promise">
                {{ item }}
              </div>
            </div>

            <div class="observable-results">
              <h4>Observable Results:</h4>
              <div *ngFor="let item of promiseData" class="result-item observable">
                {{ item }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CUSTOM OBSERVABLE SECTION -->
    <div *ngIf="activeTab() === 'custom'" class="tab-content">
      <div class="section">
        <h2>Building Custom Observables</h2>
        <div class="explanation">
          <p>Custom Observables allow you to create your own data streams with full control over emission, completion, and error handling.</p>
        </div>

        <div class="demo-section">
          <h3>Custom Observable Demo:</h3>
          <div class="custom-observable-demo">
            <div class="data-display">
              <div *ngFor="let item of customObservableData" class="data-item">
                <span *ngIf="item !== -1">{{ item }}</span>
                <span *ngIf="item === -1" class="completion">✅ Completed!</span>
              </div>
            </div>
            <p class="explanation-text">
              This custom observable emits numbers 1-5 every 500ms, then completes.
            </p>
          </div>
        </div>

                 <div class="code-example">
           <h4>Custom Observable Code:</h4>
                       <pre><code>const customObservable$ = new Observable&lt;number&gt;(observer =&gt; &#123;
  let count = 0;
  const interval = setInterval(() =&gt; &#123;
    count++;
    observer.next(count);
    if (count &gt;= 5) &#123;
      observer.complete();
      clearInterval(interval);
    &#125;
  &#125;, 500);
&#125;);</code></pre>
         </div>
      </div>
    </div>

    <!-- ERRORS SECTION -->
    <div *ngIf="activeTab() === 'errors'" class="tab-content">
      <div class="section">
        <h2>Error Handling and Completion</h2>
        <div class="explanation">
          <p>Observables provide robust error handling and completion mechanisms to handle various scenarios gracefully.</p>
        </div>

        <div class="demo-section">
          <h3>Error Handling Demo:</h3>
          <div class="error-demo">
            <div class="data-display">
              <div *ngFor="let item of errorData" class="data-item error">
                {{ item }}
              </div>
            </div>
            <p class="explanation-text">
              Demonstrates error catching and recovery using catchError operator.
            </p>
          </div>
        </div>

        <div class="demo-section">
          <h3>Completion Handling Demo:</h3>
          <div class="completion-demo">
            <div class="data-display">
              <div *ngFor="let item of completionData" class="data-item completion">
                {{ item }}
              </div>
            </div>
            <p class="explanation-text">
              Shows how to handle observable completion with proper cleanup.
            </p>
          </div>
        </div>

                 <div class="code-example">
           <h4>Error Handling Pattern:</h4>
                       <pre><code>observable$.pipe(
  catchError(error =&gt; &#123;
    console.error('Error:', error);
    return of('Recovered from error');
  &#125;)
).subscribe(&#123;
  next: (value) =&gt; console.log(value),
  error: (error) =&gt; console.error(error),
  complete: () =&gt; console.log('Completed')
&#125;);</code></pre>
         </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>This demo showcases the power of Observables and Signals in Angular applications.</p>
    <p>Check the browser console for additional logs and effects.</p>
  </div>
</div>
