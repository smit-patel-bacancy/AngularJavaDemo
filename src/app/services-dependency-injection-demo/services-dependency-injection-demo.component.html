<div class="services-dependency-injection-demo">
  <div class="header">
    <h1>Services & Dependency Injection Demo</h1>
    <p>Comprehensive demonstration of Angular Services and Dependency Injection patterns</p>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button *ngFor="let tab of tabs" [class.active]="activeTab() === tab" (click)="setActiveTab(tab)"
      class="tab-button">
      {{ tab | titlecase }}
    </button>
  </div>

  <!-- Content Sections -->
  <div class="content-area">

    <!-- OVERVIEW SECTION -->
    <div *ngIf="activeTab() === 'overview'" class="tab-content">
      <div class="section">
        <h2>1. Why do we need Services?</h2>
        <div class="explanation">
          <p>Services in Angular provide a way to share data and functionality across components, following the Single
            Responsibility Principle and promoting code reusability.</p>
          <div class="benefits-grid">
            <div class="benefit-card">
              <h4>🔧 Code Reusability</h4>
              <p>Share logic across multiple components without duplication</p>
            </div>
            <div class="benefit-card">
              <h4>📊 Data Management</h4>
              <p>Centralized data storage and state management</p>
            </div>
            <div class="benefit-card">
              <h4>🔗 Cross-Component Communication</h4>
              <p>Enable components to communicate without direct coupling</p>
            </div>
            <div class="benefit-card">
              <h4>🧪 Testability</h4>
              <p>Easier to unit test isolated business logic</p>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>2. Service Instance Management</h2>
        <div class="explanation">
          <p>Angular's dependency injection system manages service instances based on their provider configuration.</p>
          <div class="instance-demo">
            <h4>Current Service Instances:</h4>
            <div class="instance-list">
              <div *ngFor="let service of ['DataService', 'LoggerService', 'CommunicationService', 'AnalyticsService']"
                class="instance-item">
                <strong>{{ service }}:</strong> {{ getServiceInstanceId(service) }}
              </div>
            </div>
            <p class="note">All services are configured as singletons (providedIn: 'root')</p>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>3. Statistics Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <h4>Users</h4>
            <div class="stat-value">{{ statistics().userCount }}</div>
          </div>
          <div class="stat-card">
            <h4>Products</h4>
            <div class="stat-value">{{ statistics().productCount }}</div>
          </div>
          <div class="stat-card">
            <h4>Logs</h4>
            <div class="stat-value">{{ statistics().logCount }}</div>
          </div>
          <div class="stat-card">
            <h4>Messages</h4>
            <div class="stat-value">{{ statistics().messageCount }}</div>
          </div>
          <div class="stat-card">
            <h4>Analytics Events</h4>
            <div class="stat-value">{{ statistics().analyticsCount }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- DATA SERVICE SECTION -->
    <div *ngIf="activeTab() === 'data'" class="tab-content">
      <div class="section">
        <h2>Data Service Demo</h2>
        <div class="explanation">
          <p>The DataService demonstrates CRUD operations, reactive data streams, and singleton pattern.</p>
        </div>

        <div class="demo-section">
          <h3>Add New User</h3>
          <div class="form-group">
            <input type="text" placeholder="Name" [value]="newUser().name" (input)="updateNewUserName($event)"
              class="form-input">
            <input type="email" placeholder="Email" [value]="newUser().email" (input)="updateNewUserEmail($event)"
              class="form-input">
            <select [value]="newUser().role" (change)="updateNewUserRole($event)" class="form-input">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
            <button (click)="addUser()" class="btn btn-primary">Add User</button>
          </div>
        </div>

        <div class="demo-section">
          <h3>Add New Product</h3>
          <div class="form-group">
            <input type="text" placeholder="Product Name" [value]="newProduct().name"
              (input)="updateNewProductName($event)" class="form-input">
            <input type="number" placeholder="Price" [value]="newProduct().price"
              (input)="updateNewProductPrice($event)" class="form-input">
            <input type="text" placeholder="Category" [value]="newProduct().category"
              (input)="updateNewProductCategory($event)" class="form-input">
            <button (click)="addProduct()" class="btn btn-primary">Add Product</button>
          </div>
        </div>

        <div class="demo-section">
          <h3>Search & Filter</h3>
          <input type="text" placeholder="Search users and products..." [value]="searchQuery()"
            (input)="updateSearchQuery($event)" class="form-input search-input">
        </div>

        <div class="data-display">
          <div class="data-section">
            <h4>Users ({{ filteredUsers().length }})</h4>
            <div *ngFor="let user of filteredUsers()" class="data-item">
              <div class="item-info">
                <strong>{{ user.name }}</strong> ({{ user.email }})
                <span class="role-badge" [class.admin]="user.role === 'admin'">{{ user.role }}</span>
              </div>
              <div class="item-actions">
                <button (click)="updateUser(user)" class="btn btn-secondary btn-sm">
                  Toggle Role
                </button>
                <button (click)="deleteUser(user.id)" class="btn btn-danger btn-sm">
                  Delete
                </button>
              </div>
            </div>
          </div>

          <div class="data-section">
            <h4>Products ({{ filteredProducts().length }})</h4>
            <div *ngFor="let product of filteredProducts()" class="data-item">
              <div class="item-info">
                <strong>{{ product.name }}</strong> - ${{ product.price }}
                <span class="category-badge">{{ product.category }}</span>
              </div>
              <div class="item-actions">
                <button (click)="deleteProduct(product.id)" class="btn btn-danger btn-sm">
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LOGGING SECTION -->
    <div *ngIf="activeTab() === 'logging'" class="tab-content">
      <div class="section">
        <h2>Logger Service Demo</h2>
        <div class="explanation">
          <p>The LoggerService demonstrates centralized logging with different log levels and reactive updates.</p>
        </div>

        <div class="demo-section">
          <h3>Add Log Entry</h3>
          <div class="form-group">
            <select #logLevel class="form-input">
              <option value="info">Info</option>
              <option value="warn">Warning</option>
              <option value="error">Error</option>
              <option value="debug">Debug</option>
            </select>
            <input type="text" placeholder="Log message..." #logMessage class="form-input">
            <button (click)="addLogFromTemplate(logLevel, logMessage)" class="btn btn-primary">Add Log</button>
          </div>
        </div>

        <div class="demo-section">
          <h3>Log Entries ({{ logs().length }})</h3>
          <div class="logs-container">
            <div *ngFor="let log of logs()" class="log-entry" [class]="'log-' + log.level">
              <div class="log-header">
                <span class="log-level">{{ log.level.toUpperCase() }}</span>
                <span class="log-timestamp">{{ log.timestamp | date:'short' }}</span>
                <span class="log-component">{{ log.component }}</span>
              </div>
              <div class="log-message">{{ log.message }}</div>
            </div>
          </div>
          <button (click)="clearLogs()" class="btn btn-secondary">Clear Logs</button>
        </div>
      </div>
    </div>

    <!-- COMMUNICATION SECTION -->
    <div *ngIf="activeTab() === 'communication'" class="tab-content">
      <div class="section">
        <h2>Communication Service Demo</h2>
        <div class="explanation">
          <p>The CommunicationService demonstrates cross-component communication using observables and subjects.</p>
        </div>

        <div class="demo-section">
          <h3>Send Message</h3>
          <div class="form-group">
            <input type="text" placeholder="To component..." #toComponent class="form-input">
            <select #messageType class="form-input">
              <option value="info">Info</option>
              <option value="warning">Warning</option>
              <option value="error">Error</option>
              <option value="success">Success</option>
            </select>
            <input type="text" placeholder="Message content..." #messageContent class="form-input">
            <button (click)="sendMessageFromTemplate(toComponent, messageContent, messageType)"
              class="btn btn-primary">Send Message</button>
          </div>
        </div>

        <div class="demo-section">
          <h3>Broadcast Event</h3>
          <div class="form-group">
            <input type="text" placeholder="Event action..." #eventAction class="form-input">
            <input type="text" placeholder="Event data (optional)..." #eventData class="form-input">
            <button
              (click)="broadcastEvent(eventAction.value, eventData.value); eventAction.value = ''; eventData.value = ''"
              class="btn btn-primary">Broadcast Event</button>
          </div>
        </div>

        <div class="demo-section">
          <h3>Messages ({{ messages().length }})</h3>
          <div class="messages-container">
            <div *ngFor="let message of messages()" class="message-entry" [class]="'message-' + message.type">
              <div class="message-header">
                <span class="message-type">{{ message.type.toUpperCase() }}</span>
                <span class="message-from">{{ message.from }} → {{ message.to }}</span>
                <span class="message-timestamp">{{ message.timestamp | date:'short' }}</span>
              </div>
              <div class="message-content">{{ message.content }}</div>
            </div>
          </div>
          <button (click)="clearMessages()" class="btn btn-secondary">Clear Messages</button>
        </div>

        <div class="demo-section">
          <h3>Component Events ({{ componentEvents().length }})</h3>
          <div class="events-container">
            <div *ngFor="let event of componentEvents()" class="event-entry">
              <div class="event-header">
                <span class="event-component">{{ event.component }}</span>
                <span class="event-action">{{ event.action }}</span>
                <span class="event-timestamp">{{ event.timestamp | date:'short' }}</span>
              </div>
              <div *ngIf="event.data" class="event-data">
                Data: {{ event.data | json }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ANALYTICS SECTION -->
    <div *ngIf="activeTab() === 'analytics'" class="tab-content">
      <div class="section">
        <h2>Analytics Service Demo</h2>
        <div class="explanation">
          <p>The AnalyticsService demonstrates service injection into other services and event tracking.</p>
        </div>

        <div class="demo-section">
          <h3>Analytics Events ({{ analyticsEvents().length }})</h3>
          <div class="analytics-container">
            <div *ngFor="let event of analyticsEvents()" class="analytics-entry">
              <div class="analytics-header">
                <span class="analytics-type">{{ event.eventType }}</span>
                <span class="analytics-component">{{ event.component }}</span>
                <span class="analytics-timestamp">{{ event.timestamp | date:'short' }}</span>
              </div>
              <div *ngIf="event.data" class="analytics-data">
                Data: {{ event.data | json }}
              </div>
            </div>
          </div>
          <div class="analytics-actions">
            <button (click)="clearAnalytics()" class="btn btn-secondary">Clear Analytics</button>
            <button (click)="exportAnalytics()" class="btn btn-primary">Export Analytics</button>
          </div>
        </div>
      </div>
    </div>

    <!-- HIERARCHY SECTION -->
    <div *ngIf="activeTab() === 'hierarchy'" class="tab-content">
      <div class="section">
        <h2>Hierarchical Injector Demo</h2>
        <div class="explanation">
          <p>Angular's hierarchical injector system allows services to be provided at different levels in the component
            tree.</p>
        </div>

        <div class="hierarchy-demo">
          <h3>Component Hierarchy</h3>
          <div class="hierarchy-tree">
            <div class="hierarchy-node root">
              <strong>ServicesDependencyInjectionDemoComponent</strong>
              <p>Services: DataService, LoggerService, CommunicationService, AnalyticsService</p>
            </div>
            <div class="hierarchy-arrow">↓</div>
            <div class="hierarchy-node child">
              <strong>ChildComponent</strong>
              <p>Inherits services from parent</p>
            </div>
            <div class="hierarchy-arrow">↓</div>
            <div class="hierarchy-node grandchild">
              <strong>GrandchildComponent</strong>
              <p>Inherits services from parent chain</p>
            </div>
          </div>
        </div>

        <div class="demo-section">
          <h3>Child Component Demo</h3>
          <app-child-component></app-child-component>
        </div>
      </div>
    </div>

    <!-- INSTANCES SECTION -->
    <div *ngIf="activeTab() === 'instances'" class="tab-content">
      <div class="section">
        <h2>Service Instance Management</h2>
        <div class="explanation">
          <p>Understanding how many instances of a service are created and how they are managed by Angular's DI system.
          </p>
        </div>

        <div class="instance-management">
          <h3>Service Instance Types</h3>
          <div class="instance-types">
            <div class="instance-type">
              <h4>🔗 Singleton (providedIn: 'root')</h4>
              <p>One instance for the entire application</p>
              <ul>
                <li>DataService</li>
                <li>LoggerService</li>
                <li>CommunicationService</li>
                <li>AnalyticsService</li>
              </ul>
            </div>
            <div class="instance-type">
              <h4>🏗️ Component-Level (providedIn: 'any')</h4>
              <p>One instance per component tree</p>
              <ul>
                <li>Useful for feature-specific services</li>
                <li>Shared within a component subtree</li>
              </ul>
            </div>
            <div class="instance-type">
              <h4>🔄 Factory (useFactory)</h4>
              <p>Custom instance creation logic</p>
              <ul>
                <li>Dynamic service creation</li>
                <li>Configuration-based instances</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="demo-section">
          <h3>Current Service Instances</h3>
          <div class="instance-display">
            <div *ngFor="let service of ['DataService', 'LoggerService', 'CommunicationService', 'AnalyticsService']"
              class="instance-card">
              <h4>{{ service }}</h4>
              <div class="instance-id">{{ getServiceInstanceId(service) }}</div>
              <div class="instance-status">✅ Singleton Instance</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-actions">
      <button (click)="simulateError()" class="btn btn-warning">Simulate Error</button>
      <button (click)="resetAllData()" class="btn btn-danger">Reset All Data</button>
    </div>
    <p>This demo showcases the power of Services and Dependency Injection in Angular applications.</p>
    <p>Check the browser console for additional logs and service instance information.</p>
  </div>
</div>
